# Prerequisites.
We used ansible playbook from [project](https://github.com/Alliedium/awesome-jenkins/) to install and set up Jenkins and to create multistaged [pipeline](https://www.jenkins.io/doc/book/pipeline/getting-started/). 

# Pipeline description
  Our Jenkins script has 4 stages: _Clone_, _Build_, _Static code analysis_ and _Test_. 
  We can select maven version that will be used during the build and different set of rules to perform static code analysis.

   1. In the first stage the project will be cloned from the GitHub repository.

   2. In the _Build_ stage maven dependencies are downloaded and jar file is build. Here we used the _default_ maven profile from our pom.xml file:
        `mvn compile`
   3. The static code analysis is performed during the _Static code analysis_ stage by activating _static-code-analysis_ maven profile:
        `mvn -X compile -P static-code-analysis`
   4. In the stage _Test_ the unit tests are running and the test coverage report is provided via maven command:
        `mvn test -P tests`

# Static code analysis
 We used the following maven plugins to perform static code analysis: [spotbugs plugin](https://spotbugs.github.io/spotbugs-maven-plugin/), [pmd/cpd](https://pmd.github.io/latest/pmd_userdocs_tools_maven.html), [checkhttps://www.softwaretestinghelp.com/code-coverage-tools/style](https://checkstyle.org/) 
       
  Spotbugs plugin is used to find bugs in Java cod. It can scan bytecode generated by JDK8. The support of JDK 11 and newer versions is still experimental. 
  
  CPD plugin helps to avoid duplicated code in your project. It is usually used together with PMD plugin, that looks for bad practices. CPD and PMD plugins are concerned with Java and Apex, but support also some other languages.
  The rules used by [Spotbugs](https://spotbugs.readthedocs.io/en/stable/filter.html#) and [PMD](https://pmd.github.io/pmd/pmd_userdocs_extending_writing_rules_intro.html) can be customized, however we used the default ones.  
  Checkstyle plugin performs code analysis according the convention standards. This combination of plugins is often used to perform static code analysis.
  
### Checkstyle plugin
  Checkstyle plugin uses by default sun style standards described in the [sun_checks.xml file](https://github.com/checkstyle/checkstyle/blob/master/src/main/resources/sun_checks.xml). 
However, the [google style standards](https://github.com/checkstyle/checkstyle/blob/master/src/main/resources/google_checks.xml) or custom rules can be applied as well, by configuring plugin settings.

To indicate your rule set file location add the following lines into the plugin configuration in pom.xml: `<configLocation>${codestyle.checks.file}</configLocation>`  - for the rule set and  `<suppressionsLocation>${codestyle.suppressions.file}</suppressionsLocation>` - for the suppressions

  or set them directly in the commandline:
    `mvn -X install -P static-code-analysis -Dcodestyle.checks.file=./codestyle/checkstyle_checks.xml -Dcodestyle.suppressions.file=./codestyle/checkstyle_suppressions.xml`

  In this project we have 2 files with rules: _sun_checks.xml_; _checkstyle_checks.xml_ - all parameters are the same as in the sun rules set, but the maximum line length; 1 suppression file _checkstyle_suppressions.xml_ - here we have suppressed Javadoc checks. 
  So, Jenkins Job has 4 options/combinations for codestyle checks: 
* sun_checks (default)
* sun_checks_with_suppressions
* custom_checks
* custom_checks_with_suppressions

### Static code analysis reports
  Static code analysis reports are published on Jenkins by using [WarningNG plugin](https://plugins.jenkins.io/warnings-ng/). 
  We disabled build failure in the case if number of bugs or/and warnings will exceed predefined values by setting `failOnError: false`.  If you prefer to _fail_ your build you can set cut-off number of bugs and warnings for successful build and set `failOnError: true`. This parameter, as well as cut-off numbers are [set](https://www.jenkins.io/doc/pipeline/steps/warnings-ng/) separately for each static analysis tools supported by WarningNG plugin.

## Test coverage report
   We used [Jacoco maven plugin](https://www.eclemma.org/jacoco/trunk/doc/maven.html) to do test coverage analysis.
   The report is published in Jenkins by the means of the [HTML publisher Jenkins plugin](https://plugins.jenkins.io/htmlpublisher/).

## References:
1. [DevOps_guide](https://www.polestarllp.com/blog/devops-guide-pipeline-challenges-latest-trends)
2. [Git_workflow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow)
3. [GitOps_principles](https://rafay.co/the-kubernetes-current/gitops-principles-and-workflows-every-team-should-know/)
4. [Introduction_to_maven_profiles](https://maven.apache.org/guides/introduction/introduction-to-profiles.html)
5. [Maven_profiles](https://www.baeldung.com/maven-profiles)
6. [Maven_profiles_detailed_explanation](https://medium.com/javarevisited/maven-profiles-detailed-explanation-1b4c8204466a)
7. [Jenkinsfile](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/)
8. [Pipeline syntax](https://www.jenkins.io/doc/book/pipeline/syntax/)
9. [Jenkins plugin - Pipeline: Stage Step](https://plugins.jenkins.io/pipeline-stage-step/)
10. [Jenkins plugin - Pipeline: Stage View](https://plugins.jenkins.io/pipeline-stage-view/)
11. [Comparison of findbugs(spotbugs), pmd and checkstyle plugins](https://www.sw-engineering-candies.com/blog-1/comparison-of-findbugs-pmd-and-checkstyle)
12. [Spotbugs](https://spotbugs.readthedocs.io/en/stable/introduction.html)
13. [Spotbugs maven plugin documentation](https://spotbugs.readthedocs.io/en/stable/maven.html)
14. [Test_coverage_tools](https://www.softwaretestinghelp.com/code-coverage-tools/)
15. [Jacoco_maven_plugin](https://www.baeldung.com/jacoco)
